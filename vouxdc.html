<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>说明 | KyleThanas</title>
    <meta name="description" content="KyleThanas的分享">
    
    
    <link rel="preload" href="/assets/css/0.styles.d6f0e1c6.css" as="style"><link rel="preload" href="/assets/js/app.65938e89.js" as="script"><link rel="preload" href="/assets/js/2.70522405.js" as="script"><link rel="preload" href="/assets/js/35.0c6f698c.js" as="script"><link rel="prefetch" href="/assets/js/10.f88b2f75.js"><link rel="prefetch" href="/assets/js/11.12d14ef9.js"><link rel="prefetch" href="/assets/js/12.cf25a585.js"><link rel="prefetch" href="/assets/js/13.9d6e52f0.js"><link rel="prefetch" href="/assets/js/14.fb27a11e.js"><link rel="prefetch" href="/assets/js/15.e3777094.js"><link rel="prefetch" href="/assets/js/16.0003a320.js"><link rel="prefetch" href="/assets/js/17.4db53a37.js"><link rel="prefetch" href="/assets/js/18.a92db625.js"><link rel="prefetch" href="/assets/js/19.95a43c09.js"><link rel="prefetch" href="/assets/js/20.55e02087.js"><link rel="prefetch" href="/assets/js/21.0aab5835.js"><link rel="prefetch" href="/assets/js/22.b074c373.js"><link rel="prefetch" href="/assets/js/23.f916e61b.js"><link rel="prefetch" href="/assets/js/24.13384c36.js"><link rel="prefetch" href="/assets/js/25.db3e4a57.js"><link rel="prefetch" href="/assets/js/26.5d4c5d96.js"><link rel="prefetch" href="/assets/js/27.a01cdb18.js"><link rel="prefetch" href="/assets/js/28.9e6dd71d.js"><link rel="prefetch" href="/assets/js/29.4dfc3a2a.js"><link rel="prefetch" href="/assets/js/3.516fd641.js"><link rel="prefetch" href="/assets/js/30.c1eb0014.js"><link rel="prefetch" href="/assets/js/31.4a51184f.js"><link rel="prefetch" href="/assets/js/32.6f78dff7.js"><link rel="prefetch" href="/assets/js/33.585d92fc.js"><link rel="prefetch" href="/assets/js/34.d7438e1d.js"><link rel="prefetch" href="/assets/js/36.f1c1551f.js"><link rel="prefetch" href="/assets/js/4.bb3de599.js"><link rel="prefetch" href="/assets/js/5.fb8b6cb7.js"><link rel="prefetch" href="/assets/js/6.7b59c7a3.js"><link rel="prefetch" href="/assets/js/7.0e742678.js"><link rel="prefetch" href="/assets/js/8.966588c9.js"><link rel="prefetch" href="/assets/js/9.a2ab8888.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d6f0e1c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">KyleThanas</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://support.qq.com/product/65891" target="_blank" rel="noopener noreferrer" class="nav-link external">
  吐槽
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://support.qq.com/product/65891" target="_blank" rel="noopener noreferrer" class="nav-link external">
  吐槽
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>typescript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cqbaxh.html" class="sidebar-link">typescript（一）-- 概述</a></li><li><a href="/ybzci8.html" class="sidebar-link">typescript（二）-- 基础类型</a></li><li><a href="/ab0g2p.html" class="sidebar-link">typescript（三）-- 高级类型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cm9fdg.html" class="sidebar-link">this指向</a></li><li><a href="/es3vml.html" class="sidebar-link">Angular</a></li><li><a href="/lq3gzm.html" class="sidebar-link">页面渲染性能优化</a></li><li><a href="/uxy0d2.html" class="sidebar-link">前端2019（持续更新）</a></li><li><a href="/zy95lc.html" class="sidebar-link">FileReader总结</a></li><li><a href="/dd4f3r.html" class="sidebar-link">Promise总结</a></li><li><a href="/vouxdc.html" class="active sidebar-link">Fetch总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vouxdc.html#说明" class="sidebar-link">说明</a></li><li class="sidebar-sub-header"><a href="/vouxdc.html#支持" class="sidebar-link">支持</a></li><li class="sidebar-sub-header"><a href="/vouxdc.html#常见问题" class="sidebar-link">常见问题</a></li><li class="sidebar-sub-header"><a href="/vouxdc.html#参考" class="sidebar-link">参考</a></li><li class="sidebar-sub-header"><a href="/vouxdc.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/bf3n8q.html" class="sidebar-link">async/await总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>实用技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nstgdi.html" class="sidebar-link">Git常用命令，及.gitignore的配置</a></li><li><a href="/evnxrm.html" class="sidebar-link">视频播放--自动播放</a></li><li><a href="/qcfngw.html" class="sidebar-link">js编码解码</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>读书</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>《精通css》第三版</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/gi59fg.html" class="sidebar-link">第一天</a></li><li><a href="/xh646h.html" class="sidebar-link">第二天</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>杂学</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading open"><span>哲理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hyvqi3.html" class="sidebar-link">人生</a></li><li><a href="/phbr3v.html" class="sidebar-link">编程</a></li><li><a href="/quy23w.html" class="sidebar-link">职场</a></li><li><a href="/apg82h.html" class="sidebar-link">知乎精选</a></li><li><a href="/zrqivm.html" class="sidebar-link">拼搏的意义</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>MEGA</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ihd3eq.html" class="sidebar-link">MEGA7使用</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>Excel</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lnadeg.html" class="sidebar-link">更改日期</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>装修</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yzgdkq.html" class="sidebar-link">家装注意事项</a></li><li><a href="/cvv7ox.html" class="sidebar-link">地板or瓷砖</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>茶叶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nvd0og.html" class="sidebar-link">茶叶的分类</a></li><li><a href="/vy7e6o.html" class="sidebar-link">合适的茶叶与注意事项</a></li><li><a href="/usxmag.html" class="sidebar-link">区分茶叶的好坏</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>红葡萄酒</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/oqz9zt.html" class="sidebar-link">红酒和葡萄酒有什么区别</a></li><li><a href="/opxkta.html" class="sidebar-link">葡萄酒陈年</a></li><li><a href="/fiiet7.html" class="sidebar-link">单宁简介</a></li></ul></section></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h2 id="说明"><a href="#说明" aria-hidden="true" class="header-anchor">#</a> 说明</h2> <p>由于 Fetch API 是基于 Promise 设计，有必要先学习一下 Promise。旧浏览器不支持 Promise，需要使用 polyfill <a href="https://github.com/stefanpenner/es6-promise" target="_blank">es6-promise</a> 。</p><p>如果不支持fetch也没有问题，可以使用第三方的ployfill来实现只会fetch：<a href="https://github.com/github/fetch" target="_blank">whatwg-fetch</a> 这个用的人多。</p> <h1 id="开始"><a href="#开始" aria-hidden="true" class="header-anchor">#</a> 开始</h1> <p>发送一个json请求</p> <h3 id="xhr方式"><a href="#xhr方式" aria-hidden="true" class="header-anchor">#</a> XHR方式</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Oops, error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h4 id="fetch方式"><a href="#fetch方式" aria-hidden="true" class="header-anchor">#</a> fetch方式</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><p>或者：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre></div><p>再或者：</p><blockquote><p>async/await 是非常新的 API，属于 ES7</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
   <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
   <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>使用 await 后，写异步代码就像写同步代码一样爽。await 后面可以跟 Promise 对象，表示等待 Promise resolve() 才会继续向下执行，如果 Promise 被 reject() 或抛出异常则会被外面的 try...catch 捕获。</p> <h4 id="fetch-get请求初步"><a href="#fetch-get请求初步" aria-hidden="true" class="header-anchor">#</a> fetch GET请求初步</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   method<span class="token punctuation">:</span> <span class="token string">'GET'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="fetch-get请求的参数传递"><a href="#fetch-get请求的参数传递" aria-hidden="true" class="header-anchor">#</a> fetch GET请求的参数传递</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">'?a=1&amp;b=2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// 在URL中写上传递的参数</span>
   method<span class="token punctuation">:</span> <span class="token string">'GET'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="fetch-post请求初步"><a href="#fetch-post请求初步" aria-hidden="true" class="header-anchor">#</a> fetch POST请求初步</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   method<span class="token punctuation">:</span> <span class="token string">'POST'</span> <span class="token comment">// 指定是POST请求</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="fetch-post请求参数的传递"><a href="#fetch-post请求参数的传递" aria-hidden="true" class="header-anchor">#</a> fetch POST请求参数的传递</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
   body<span class="token punctuation">:</span> formData<span class="token punctuation">,</span><span class="token comment">// 这里是请求对象</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="fetch-设置请求的头信息"><a href="#fetch-设置请求的头信息" aria-hidden="true" class="header-anchor">#</a> fetch 设置请求的头信息</h4> <p>在POST提交的过程中，一般是表单提交，可是，经过查询，发现默认的提交方式是：<code>Content-Type:text/plain;charset=UTF-8</code>，这个显然是不合理的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
   headers<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span> <span class="token comment">// 指定提交方式为表单提交</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   body<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="fetch-通过接口得到json数据"><a href="#fetch-通过接口得到json数据" aria-hidden="true" class="header-anchor">#</a> fetch 通过接口得到JSON数据</h4> <p>上面所有的例子中都是返回一个文本</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>
   url<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// 在URL中写上传递的参数</span>
       method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
       headers<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
           <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span> <span class="token comment">// 通过头指定，获取的数据类型是JSON</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回一个Promise，可以解析成JSON</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 获取JSON数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="fetch-强制带cookie"><a href="#fetch-强制带cookie" aria-hidden="true" class="header-anchor">#</a> fetch 强制带Cookie</h4> <p>默认情况下, fetch 不会从服务端发送或接收任何 cookies, 如果站点依赖于维护一个用户会话，则导致未经认证的请求(要发送 cookies，必须发送凭据头).</p><p>fetch(url, {</p><p>method: 'GET',</p><p>credentials: 'include' // 强制加入凭据头</p><p>})</p> <h4 id="fetch-简单封装一下"><a href="#fetch-简单封装一下" aria-hidden="true" class="header-anchor">#</a> fetch 简单封装一下</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
* 将对象转成 a=1&amp;b=2的形式
* @param obj 对象
*/</span>
<span class="token keyword">function</span> <span class="token function">obj2String</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   arr<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>item<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 真正的请求
* @param url 请求地址
* @param options 请求参数
* @param method 请求方式
*/</span>
<span class="token keyword">function</span> <span class="token function">commonFetcdh</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> searchStr <span class="token operator">=</span> <span class="token function">obj2String</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
 <span class="token keyword">let</span> initObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果是GET请求，拼接url</span>
   url <span class="token operator">+=</span> <span class="token string">'?'</span> <span class="token operator">+</span> searchStr
   initObj <span class="token operator">=</span> <span class="token punctuation">{</span>
     method<span class="token punctuation">:</span> method<span class="token punctuation">,</span>
     credentials<span class="token punctuation">:</span> <span class="token string">'include'</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   initObj <span class="token operator">=</span> <span class="token punctuation">{</span>
     method<span class="token punctuation">:</span> method<span class="token punctuation">,</span>
     credentials<span class="token punctuation">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span>
     headers<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
       <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     body<span class="token punctuation">:</span> searchStr
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> initObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> res
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* GET请求
* @param url 请求地址
* @param options 请求参数
*/</span>
<span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">commonFetcdh</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* POST请求
* @param url 请求地址
* @param options 请求参数
*/</span>
<span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">commonFetcdh</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">GET</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/search/error.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token constant">POST</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/search/error.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h2 id="支持"><a href="#支持" aria-hidden="true" class="header-anchor">#</a> 支持</h2> <p><img src="https://cdn.nlark.com/yuque/0/2019/png/124615/1552380426413-f190eed9-ee6b-468b-802f-1bcf398904aa.png#align=left&amp;display=inline&amp;height=406&amp;originHeight=411&amp;originWidth=756&amp;size=0&amp;status=done&amp;width=746" style="max-width:600px;width:746px;"></p><p>原生支持率并不高，幸运的是，引入下面这些 polyfill 后可以完美支持 IE8+ ：</p><ul><li>由于 IE8 是 ES3，需要引入 ES5 的 polyfill: <a href="https://github.com/es-shims/es5-shim" target="_blank">es5-shim,es5-sham</a></li></ul><ul><li>引入 Promise 的 polyfill: <a href="https://github.com/stefanpenner/es6-promise" target="_blank">es6-promise</a></li></ul><ul><li>引入 fetch 探测库：<a href="https://github.com/camsong/fetch-detector" target="_blank">fetch-detector</a></li></ul><ul><li>引入 fetch 的 polyfill: <a href="https://github.com/camsong/fetch-ie8" target="_blank">fetch-ie8</a></li></ul><ul><li>可选：如果你还使用了 jsonp，引入 <a href="https://github.com/camsong/fetch-jsonp" target="_blank">fetch-jsonp</a></li></ul><ul><li>可选：开启 Babel 的 <a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime#docsNav" target="_blank">runtime</a> 模式 或者 使用<a href="https://github.com/facebook/regenerator" target="_blank">regenerator</a>，现在就使用 async/await</li></ul> <h2 id="常见问题"><a href="#常见问题" aria-hidden="true" class="header-anchor">#</a> 常见问题</h2> <ul><li>Fetch 请求默认是不带 cookie 的，需要设置 <code>fetch(url, {credentials: 'include'})</code>。</li></ul><ul><li>服务器返回 400，500 错误码时并不会 reject，只有网络错误这些导致请求不能完成时，fetch 才会被 reject。</li></ul><ul><li>所有版本的 IE 均不支持原生 Fetch，fetch-ie8 会自动使用 XHR 做 polyfill。但在跨域时有个问题需要处理。IE8, 9 的 XHR 不支持 CORS 跨域。</li></ul><ul><li>Response返回一个被解析后的promise对象和数据，有这些解析方式：arrayBuffer()、blob()、、json()、text()、formData()</li></ul> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ol start="1"><li><a href="https://segmentfault.com/a/1190000003810652" target="_blank">传统 Ajax 已死，Fetch 永生</a></li></ol><ol start="2"><li><a href="https://segmentfault.com/a/1190000011433064" target="_blank">fetch，终于认识你</a></li></ol> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <ul><li>语法简洁，更加语义化</li></ul><ul><li>基于标准 Promise 实现，支持 async/await</li></ul><ul><li>同构方便，使用<a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank">isomorphic-fetch</a></li></ul><blockquote><p>注：同构(isomorphic/universal)就是使前后端运行同一套代码的意思，后端一般是指 NodeJS 环境。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dd4f3r.html" class="prev">
          Promise总结
        </a></span> <span class="next"><a href="/bf3n8q.html">
          async/await总结
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65938e89.js" defer></script><script src="/assets/js/2.70522405.js" defer></script><script src="/assets/js/35.0c6f698c.js" defer></script>
  </body>
</html>
