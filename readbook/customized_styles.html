<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>定义样式 | Ant Design 1111</title>
    <meta name="description" content="基于 umi 的 Ant Design 1111">
    
    
    <link rel="preload" href="/readbook/assets/css/0.styles.d6f0e1c6.css" as="style"><link rel="preload" href="/readbook/assets/js/app.205826b5.js" as="script"><link rel="preload" href="/readbook/assets/js/2.6adc2b3f.js" as="script"><link rel="preload" href="/readbook/assets/js/17.097f1891.js" as="script"><link rel="prefetch" href="/readbook/assets/js/10.1636d440.js"><link rel="prefetch" href="/readbook/assets/js/11.70bf2f3a.js"><link rel="prefetch" href="/readbook/assets/js/12.a107a538.js"><link rel="prefetch" href="/readbook/assets/js/13.33cb767d.js"><link rel="prefetch" href="/readbook/assets/js/14.f9871772.js"><link rel="prefetch" href="/readbook/assets/js/15.a8ea189d.js"><link rel="prefetch" href="/readbook/assets/js/16.288634c2.js"><link rel="prefetch" href="/readbook/assets/js/18.45ae2ea1.js"><link rel="prefetch" href="/readbook/assets/js/19.8e74b4bc.js"><link rel="prefetch" href="/readbook/assets/js/20.6000349f.js"><link rel="prefetch" href="/readbook/assets/js/21.8853e1e1.js"><link rel="prefetch" href="/readbook/assets/js/22.90d3a464.js"><link rel="prefetch" href="/readbook/assets/js/23.fabe9af3.js"><link rel="prefetch" href="/readbook/assets/js/24.af897bcf.js"><link rel="prefetch" href="/readbook/assets/js/25.bc2baf43.js"><link rel="prefetch" href="/readbook/assets/js/26.ec5f48b3.js"><link rel="prefetch" href="/readbook/assets/js/27.284db135.js"><link rel="prefetch" href="/readbook/assets/js/28.8da8020e.js"><link rel="prefetch" href="/readbook/assets/js/29.642ed6af.js"><link rel="prefetch" href="/readbook/assets/js/3.516fd641.js"><link rel="prefetch" href="/readbook/assets/js/30.c42dcde0.js"><link rel="prefetch" href="/readbook/assets/js/31.5bf0ad56.js"><link rel="prefetch" href="/readbook/assets/js/32.28c4b9fc.js"><link rel="prefetch" href="/readbook/assets/js/33.8ba11b1c.js"><link rel="prefetch" href="/readbook/assets/js/34.f1f06cae.js"><link rel="prefetch" href="/readbook/assets/js/4.bb3de599.js"><link rel="prefetch" href="/readbook/assets/js/5.f324cf32.js"><link rel="prefetch" href="/readbook/assets/js/6.713fbf29.js"><link rel="prefetch" href="/readbook/assets/js/7.ea44b13f.js"><link rel="prefetch" href="/readbook/assets/js/8.19cb361c.js"><link rel="prefetch" href="/readbook/assets/js/9.12521701.js">
    <link rel="stylesheet" href="/readbook/assets/css/0.styles.d6f0e1c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ant Design 1111</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/intro.html" class="sidebar-link">前言</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第一章: 基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sc1lvc.html" class="sidebar-link">前端开发的演变</a></li><li><a href="/wybhm9.html" class="sidebar-link">初始化项目</a></li><li><a href="/fd5af7.html" class="sidebar-link">第一个组件</a></li><li><a href="/agmsgo.html" class="sidebar-link">使用 Ant Design 组件</a></li><li><a href="/goozth.html" class="sidebar-link">受控组件与非受控组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter2.html" class="sidebar-heading clickable"><span>第二章: 布局与路由</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/layout.html" class="sidebar-link">基本布局</a></li><li><a href="/ghalng.html" class="sidebar-link">侧边导航</a></li><li><a href="/ipsba8.html" class="sidebar-link">路由配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter3.html" class="sidebar-heading clickable"><span>第三章: 小试牛刀</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/abl3ad.html" class="sidebar-link">使用 model</a></li><li><a href="/dsl8ee.html" class="sidebar-link">搭建基于 model 的卡片列表页面</a></li><li><a href="/ig6mzb.html" class="sidebar-link">在 model 中请求服务端数据</a></li><li><a href="/kmmq56.html" class="sidebar-link">模拟服务端数据</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/chapter4.html" class="sidebar-heading clickable"><span>第四章: 复杂页面</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ndfx96.html" class="sidebar-link">表格</a></li><li><a href="/up1dn3.html" class="sidebar-link">表单</a></li><li><a href="/dk8xsp.html" class="sidebar-link">图表</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>第五章: 进阶功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/customized_styles.html" class="active sidebar-link">自定义样式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/customized_styles.html#定义样式" class="sidebar-link">定义样式</a></li><li class="sidebar-sub-header"><a href="/customized_styles.html#理解-css-modules" class="sidebar-link">理解 CSS modules</a></li><li class="sidebar-sub-header"><a href="/customized_styles.html#css-modules-与-less-语法一起使用" class="sidebar-link">CSS modules 与 Less 语法一起使用</a></li><li class="sidebar-sub-header"><a href="/customized_styles.html#在-css-modules-中覆盖-antd-样式" class="sidebar-link">在 CSS modules 中覆盖 antd 样式</a></li><li class="sidebar-sub-header"><a href="/customized_styles.html#更换-antd-主题" class="sidebar-link">更换 antd 主题</a></li><li class="sidebar-sub-header"><a href="/customized_styles.html#更改全局样式" class="sidebar-link">更改全局样式</a></li></ul></li><li><a href="/wvbsue.html" class="sidebar-link">上传与下载</a></li><li><a href="/aut0sr.html" class="sidebar-link">国际化</a></li><li><a href="/lifemethods.html" class="sidebar-link">React 的生命周期</a></li><li><a href="/auth.html" class="sidebar-link">权限</a></li><li><a href="/unittest.html" class="sidebar-link">单元测试</a></li><li><a href="/typescript.html" class="sidebar-link">使用 TypeScript</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>附录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/byllph.html" class="sidebar-link">你需要了解的 ES6 语法</a></li><li><a href="/tydf0a.html" class="sidebar-link">深入理解 umi</a></li><li><a href="/about.html" class="sidebar-link">关于我们</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h2 id="定义样式"><a href="#定义样式" aria-hidden="true" class="header-anchor">#</a> 定义样式</h2> <p>在前面的章节中您可能已经了解了如何引入样式，我们这里再温习一遍。</p> <p>首先让我们制作一个最简单的显示 Hello World 的页面，并附加一些样式。关于怎样用 umi 创建一个最简单的页面，可以参考 <a href="https://umijs.org/guide/getting-started.html#%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8" target="_blank" rel="noopener noreferrer">快速上手 | UmiJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。关于目录结构，可以参考 <a href="https://umijs.org/guide/app-structure.html#%E5%A4%8D%E6%9D%82%E5%BA%94%E7%94%A8" target="_blank" rel="noopener noreferrer">目录约定 | UmiJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883056317-949f8612-824b-446a-899f-f6bf6f0f9e2c.png" alt="image.png | left | 683x530"></p> <p>我们的目标是：添加一些样式定义，使得 Hello World 文字更粗更大，变为绿色。</p> <p>第一，在 src/pages 目录下创建页面 <code>index.jsx</code> 和样式文件 <code>styles.css</code> 。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">.</span>
└── src
    └── pages
        ├── index.jsx
        └── styles.css
</code></pre></div><p>写入以下内容到文件</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">/* index.jsx */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>myStyles<span class="token punctuation">.</span>hello<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello World</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* styles.css */</span>
<span class="token selector">.hello</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #30b767<span class="token punctuation">;</span> <span class="token comment">/* 绿色 */</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>注意：</strong> 对于 css 文件，</p> <ul><li>不要在值上使用引号；</li> <li><code>.</code>号要紧跟 hello，定义一个 class 选择器。</li></ul></blockquote> <p>下面展示了错误的写法。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* 错误！1. 引号是无效的；2. hello 前面的点漏掉了 */</span>
<span class="token selector">hello</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token string">'32px'</span><span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> <span class="token string">'bold'</span><span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token string">&quot;#30b767&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第二，要把样式文件在页面文件中引用，它才能真正生效。首先添加一行 import 语句；其次在 div 的 className 属性中使用 hello。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> myStyles <span class="token keyword">from</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>myStyles<span class="token punctuation">.</span>hello<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello World</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>注意：</strong></p> <ul><li>在 React 的语境下，我们使用 <code>className</code>  保留字来定义一个 html 元素的 class，而非 w3c 标准中的 <code>class</code> 保留字。</li> <li>在 umi 中我们默认开启了 <em>CSS modules</em> 特性，这使得 class 名需要通过变量属性去引用。</li></ul></blockquote> <p>在终端中运行 <code>umi dev</code> 启动我们的应用。看到了期待中 Hello World 渲染出的样子。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883069473-eb9391c0-4684-4566-bdcb-840d392bcc2d.png" alt="image.png | left | 683x512"></p> <blockquote><p><strong>注意：</strong></p> <ul><li>如果没有预期效果，请检查是否在终端有报错，请打开浏览器的控制台看是否有相关报错。</li> <li>如果依然有问题，请检查是否正在使用某些网络工具，或者曾经不慎修改了 /etc/hosts 文件。</li></ul></blockquote> <p>因为默认开启了 <em>CSS modules</em> 特性，这份样式定义<strong>只会</strong>对 index.html 文件起作用，所以我们不用再担心不同样式文件之间的干扰。在下一节中，我们将详细地介绍 CSS modules。</p> <h2 id="理解-css-modules"><a href="#理解-css-modules" aria-hidden="true" class="header-anchor">#</a> 理解 CSS modules</h2> <p>让我们打开浏览器的调试工具（这里以 Chrome DevTool 为例子）。切到 Elements 面板，找到 Hello World。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883088174-8d34a289-bd94-4166-9d1b-b248492ae5e7.png" alt="image.png | left | 683x663"></p> <p>我们看到它实际的 class 是 <code>style__hello__&lt;hash数值&gt;</code>，并非在源文件中声明的 <code>hello</code>。这就是 CSS modules 起了作用。这个 hash 值是全局唯一的，比如通过文件路径来获得，这样 class 名称就做到了全局唯一。通过全局唯一的 CSS 命名，我们变相地获得了局部作用域的 CSS（scoped CSS）。如果一个 CSS 文件仅仅是作用在某个局部的话，我们称这样一个 CSS 文件为 <em>CSS module</em>。</p> <p><a href="https://github.com/css-modules/css-modules" target="_blank" rel="noopener noreferrer">CSS modules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 不是一个可以安装的 npm 包，也不是 w3c 中的某个标准，只是一项流行的社区规范（an opinionated proposal）。webpack browserify 等打包工具（module bundler）的能力让工具生成局部 CSS 成为可能，CSS modules 规范也应运而生。</p> <p>CSS 的局部作用域解决了大问题。在w3c 规范中，CSS 始终是「全局的」。在传统的 web 开发中，最为头痛的莫过于处理 CSS 问题。因为全局性，明明定义了样式，但就是不生效，原因可能是被其他样式定义所强制覆盖。接手老项目更是噩梦，改对了一个地方的样式，却把另外许多地方的样式打乱。这一切的罪魁祸首就是 CSS 的「全局型」。为了得到局部作用域，社区曾经流行过叫做 BEM 的方案，它 <em>约定</em> class 应该写成：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.block-name__element-name--modifier-name</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>但这终究只是一种书写 class 的命名规范（convention），可以因为疏忽被打破，每个团队之间的规范也不一定互通。CSS modules 是从工具层面给出的一套生成局部 CSS 的规范，本质还是生成全局唯一的 CSS 定义。webpack 实现了这套规范。umi 依赖 webpack，默认开启了 CSS modules 特性。</p> <blockquote><p><strong>webpack 实现 CSS module 的原理</strong></p> <p>在现代 web 开发中，服务器并不能直接使用我们写的 JS CSS HMTL 文件。事实上，我们按照规范写出代码，输入给编译工具 (transpiler) ，它最终把代码转换/打包，输出成浏览器可以使用的 JS CSS HTML。在多年的社区沉淀后，脱颖而出的是诸如 webpack 这样的工具，这类编译工具又称为 module bundler。webpack 允许我们用 import/export (ES6) 或者 require/module.exports (CommonJs) 这样的语法来书写我们的 JS 代码，它甚至允许我们在 js 里面 import 一个 CSS 文件。注意：如果脱离了 webpack 的语境，这么写当然是会引起语法错误的。</p> <p>在现代 web 开发中，<strong>我们的运行时代码强耦合了编译时工具</strong>，强耦合换来的是传统 web 开发所不可企及的新能力。对于 webpack，当我们每次写了 import A from B 的时候，我们其实是声明了一个A 对于 B 的依赖。当在 a.js 中写入 <code>import styles from a.css</code> 后，webpack 就可以把这个依赖翻译成：每当 a.js 被使用时，保证生成一个 style 标签，里面嵌入 a.css 的内容。同时 webpack 给予我们另一个能力：不同类型文件间可以信息传递。webpack 把 a.css 中的类名根据<a href="https://github.com/webpack-contrib/css-loader#localidentname" target="_blank" rel="noopener noreferrer">规则<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>编译成为全局唯一的字符串，传递给 a.js 使用，于是手工维持的命名规则就可以自动生成。</p></blockquote> <p><strong>注意：很多 CSS 选择器是不会被 CSS Modules 处理的，比如 body、div 、a 这样的 HTML 标签名就不会。我们推荐如果要定义局部 css 样式/动画， 只使用 class 或 @keyframe。</strong></p> <h2 id="css-modules-与-less-语法一起使用"><a href="#css-modules-与-less-语法一起使用" aria-hidden="true" class="header-anchor">#</a> CSS modules 与 Less 语法一起使用</h2> <p>虽然被称作 <em>CSS</em> modules，但是它完全可以和 Less 一起无缝使用，与使用普通 CSS 没有什么区别，只需要使用 Less 的语法写样式就可以了。鉴于 antd 的样式也使用了 Less 作为开发语言。所以我们的实战教程强烈推荐 CSS module 和 Less 文件一起使用。</p> <blockquote><p><strong>Less 介绍</strong></p> <p><a href="http://lesscss.org/usage/" target="_blank" rel="noopener noreferrer">Less<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个 CSS 的超集，Less 允许我们定义变量，使用嵌套式声明，定义函数等。严格说 Less 包含两部分：1. Less 的语法。2. Less 预处理器（Less preprocessor）。浏览器终究只认识 CSS，所以 Less 文件需要经过 Less 预处理器编译成为 CSS。</p> <p>在工具的支持下，一个 Less 文件首先会经过 CSS modules 的编译，把类名全局唯一化，然后才被 Less preprocessor 编译成为 CSS 文件。正因此，Less 文件可以和 CSS modules 无缝联合使用。</p></blockquote> <p>第一，我们建立一个新页面 css-modules-with-less，并且使用 less 文件作为样式文件。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">.</span>
└── src
    └── pages
        ├── css-modules-with-less
        │   ├── index.jsx
        │   └── styles.less
        ├── index.jsx
        └── styles.css
</code></pre></div><p>第二，我们定义 less 文件，故意添加一些非 css 语法，比如嵌套、变量定义。</p> <div class="language-less extra-class"><pre class="language-less"><code><span class="token variable">@grey-color<span class="token punctuation">:</span></span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> .25<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token selector">.hello</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #30b767<span class="token punctuation">;</span>
  <span class="token selector">.deleted</span> <span class="token punctuation">{</span>
    <span class="token property">text-decoration</span><span class="token punctuation">:</span> line<span class="token operator">-</span>through<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token variable">@grey-color</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第三，我们创建页面，并使用这份样式。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./styles.less'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>hello<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>deleted<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello World</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>页面效果如下：</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883542967-53767b93-7213-45f3-8698-a53c7d474b29.png" alt="image.png | left | 640x480"></p> <p>DevTools 里可以看到 less 文件被正确地编译了，并且也经过 CSS modules 处理。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883548762-e70af093-ff3e-4e41-bcb4-5b6bb45692af.png" alt="image.png | left | 555x643"></p> <h2 id="在-css-modules-中覆盖-antd-样式"><a href="#在-css-modules-中覆盖-antd-样式" aria-hidden="true" class="header-anchor">#</a> 在 CSS modules 中覆盖 antd 样式</h2> <p>全局唯一带来的特性就是样式不会被覆盖，但是我们有时就是想做样式覆盖。比如我们引用了 antd 的 Button 组件，我们想要覆盖它的一些样式属性定义。通过观察，我们知道 Button 组件中声明了 <code>.ant-btn</code> 类用来做样式定义，我们就从它入手。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883121847-e1889509-7031-433f-bdd7-819cb7cfda85.png" alt="image.png | left | 683x714"></p> <blockquote><p><strong>小技巧：</strong>
使用 DevTools 的元素选择器再配合 styles 面板，可以用来了解 antd 中使用的样式名称。</p></blockquote> <p>比如我们想要覆盖掉 <code>.ant-btn</code> 中声明的 <code>border-radius</code> 属性，来绘制圆角按钮。直观的想法是：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 在 css/less 文件中定义覆盖 --&gt;</span>
.override-ant-btn .ant-btn {
    border-radius: 16px;
}

<span class="token comment">&lt;!-- 在 html 中使用对应的 class 名称 --&gt;</span>
&lt;span className={styles['override-ant-btn']}&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span><span class="token punctuation">&gt;</span></span>加入圆角的按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>但其实是没效果的。由于 CSS modules 的使用， <code>ant-btn</code> 会被改名：</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883141110-31e72cd1-d5f8-479e-8d8c-fd51e309f44b.png" alt="image.png | left | 531x472"></p> <p>从而无法引用到 <code>ant-btn</code> 原名。</p> <p>此时 CSS modules 的 <a href="https://github.com/css-modules/css-modules#exceptions" target="_blank" rel="noopener noreferrer">global 语法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 派上了用场。它允许我们声明一个 class 名称不可被改写。语法很简单：</p> <pre><code>:global(.ant-btn) {
  // ...
}
</code></pre> <p>于是 <code>.ant-btn</code> 就不会被改写了。这里我们举一个实用的例子，来具体展示使用 global 覆盖 antd Button 组件的样式。</p> <p>第一，我们建立一个新页面 css-modules-with-antd。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">.</span>
└── src
    └── pages
        ├── css-modules-with-antd
        │   ├── index.jsx
        │   └── styles.less
        ├── css-modules-with-less
        │   ├── index.jsx
        │   └── styles.less
        ├── index.jsx
        └── styles.css
</code></pre></div><p>第二，我们建立页面文件，包含两个 antd Button，其中一个需要被样式覆盖，一个不需要。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./styles.less'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">[</span><span class="token string">'override-ant-btn'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">圆角样式按妞</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">antd 原始按钮</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>第三，我们建立样式文件覆盖 antd 原生样式，用 global 来声明不修改 class 名。</p> <pre><code>.override-ant-btn {
  :global(.ant-btn) {
    border-radius: 16px;
  }
}
</code></pre> <p>于是看到覆盖的效果。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883150954-b2429b96-a3da-4439-800d-2d620d921f16.png" alt="image.png | left | 640x480"></p> <p>最后强调，global 不应该被滥用，特别地我们建议：若想在某个文件中覆盖 antd 样式，请加上一个类似 <code>.override-ant-btn</code> 的类包裹住 global 修饰的名称，以避免全局样式声明分散在项目各处。</p> <h2 id="更换-antd-主题"><a href="#更换-antd-主题" aria-hidden="true" class="header-anchor">#</a> 更换 antd 主题</h2> <p>前面章节我们讲过如何覆盖某个页面中 antd 的样式，有时候我们想要「批量修改」 antd 的样式，这就需要利用 less 提供的一个能力：<em>modifyVars</em>。简单地讲，antd 在使用 less 定义样式时，使用了大量的变量声明。这些变量的定义在编译期是可以被工具识别并修改的。</p> <p>如果使用的是 umi ，这个过程相当简单，只需要简单地修改配置文件即可。</p> <p>第一，找到 umi 的<a href="https://umijs.org/guide/config.html" target="_blank" rel="noopener noreferrer">配置文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，如果不存在则创建一个。注意配置文件放置的<a href="https://umijs.org/guide/app-structure.html#%E5%A4%8D%E6%9D%82%E5%BA%94%E7%94%A8" target="_blank" rel="noopener noreferrer">位置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。我们这里使用 <code>.umirc.js</code> 。</p> <pre><code>├── .gitignore
├── .umirc.js
└── src
    ├── global.less
    └── pages
        ├── .umi
        │   ├── router.js
        │   └── umi.js
        ├── css-modules-with-antd
        │   ├── index.jsx
        │   └── styles.less
        ├── css-modules-with-less
        │   ├── index.jsx
        │   └── styles.less
        ├── index.jsx
        └── styles.css
</code></pre> <p>第二，把之前创建的 <code>css-modules-with-antd</code>  页面中的 Button 加上 <code>type=“primary”</code> 定义。当 type 值为 “primary” 时，Button 应该显示为蓝色按钮。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    &lt;span className={styles['override-ant-btn']}&gt;
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>圆角样式按妞<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>antd 原始按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883160791-2a10d1ef-d883-4076-9a9f-d5f69a084d80.png" alt="image.png | left | 640x480"></p> <p>第三，配置 umi 主题（实质是 modifyVars 机制）。如果是创建新文件，则写入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  theme<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;@primary-color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#30b767&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果是已存在配置文件，则把 <code>theme</code> 这一段嵌入到 export default 内部。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 若已有配置</span>
  outputPath<span class="token punctuation">:</span> <span class="token string">&quot;./build&quot;</span><span class="token punctuation">,</span>

  <span class="token comment">// 加入 theme 定义</span>
  theme<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;@primary-color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#30b767&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 绿色</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 antd Button 定义时，颜色并不是写死的，而是使用了 Less 变量。我们看到修改变量后，按钮的颜色变为了绿色。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883168104-3d65ce25-35df-4a3f-8642-bb70520193ff.png" alt="image.png | left | 640x480"></p> <p>想要知道 antd 都定义了哪些变量，可以参考<a href="https://github.com/ant-design/ant-design/blob/master/components/style/themes/default.less" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="更改全局样式"><a href="#更改全局样式" aria-hidden="true" class="header-anchor">#</a> 更改全局样式</h2> <p>如果使用 umi 的话，有一个<a href="https://umijs.org/guide/app-structure.html#%E5%A4%8D%E6%9D%82%E5%BA%94%E7%94%A8" target="_blank" rel="noopener noreferrer">专门的文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>global.less</code> 来让我们书写全局样式。这个文件并不会被 CSS modules 处理。</p> <pre><code>.
└── src
    ├── global.less
    └── pages
        ├── css-modules-with-antd
        │   ├── index.jsx
        │   └── styles.less
        ├── css-modules-with-less
        │   ├── index.jsx
        │   └── styles.less
        ├── index.jsx
        └── styles.css
</code></pre> <p>一个用途是全局性地定义 HTML 标签的样式，比如写入：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">p</span> <span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果此时去往 <code>css-modules-with-antd</code> 会发现上下两个按钮贴在一起了。</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883177136-ed18f241-d8ff-444f-a743-c0077fc6d483.png" alt="image.png | left | 640x480"></p> <p>原因是在大多数浏览器中，默认 p 元素是有 <code>1em</code> 高度的 <code>margin-bottom</code>。而我们的定义覆盖了默认的样式。</p> <p>另外一个用途是全局性地覆盖第三方库的样式，比如 antd 中的样式 。</p> <p>我们全局覆盖 <code>ant-btn</code> 的样式，增加下面的定义：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.ant-btn</span> <span class="token punctuation">{</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 3px 7px <span class="token function">rgba</span><span class="token punctuation">(</span>0, 0, 0, .5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到我们成功地添加了按钮阴影</p> <p><img src="https://cdn.yuque.com/lark/0/2018/png/58329/1531883186174-29290847-8102-4984-ac14-8a2fd58b5926.png" alt="image.png | left | 640x480"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dk8xsp.html" class="prev">
          图表
        </a></span> <span class="next"><a href="/wvbsue.html">
          上传与下载
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/readbook/assets/js/app.205826b5.js" defer></script><script src="/readbook/assets/js/2.6adc2b3f.js" defer></script><script src="/readbook/assets/js/17.097f1891.js" defer></script>
  </body>
</html>
