<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基本思路 | Ant Design 1111</title>
    <meta name="description" content="基于 umi 的 Ant Design 1111">
    
    
    <link rel="preload" href="/readbook/assets/css/0.styles.d6f0e1c6.css" as="style"><link rel="preload" href="/readbook/assets/js/app.205826b5.js" as="script"><link rel="preload" href="/readbook/assets/js/2.6adc2b3f.js" as="script"><link rel="preload" href="/readbook/assets/js/24.af897bcf.js" as="script"><link rel="prefetch" href="/readbook/assets/js/10.1636d440.js"><link rel="prefetch" href="/readbook/assets/js/11.70bf2f3a.js"><link rel="prefetch" href="/readbook/assets/js/12.a107a538.js"><link rel="prefetch" href="/readbook/assets/js/13.33cb767d.js"><link rel="prefetch" href="/readbook/assets/js/14.f9871772.js"><link rel="prefetch" href="/readbook/assets/js/15.a8ea189d.js"><link rel="prefetch" href="/readbook/assets/js/16.288634c2.js"><link rel="prefetch" href="/readbook/assets/js/17.097f1891.js"><link rel="prefetch" href="/readbook/assets/js/18.45ae2ea1.js"><link rel="prefetch" href="/readbook/assets/js/19.8e74b4bc.js"><link rel="prefetch" href="/readbook/assets/js/20.6000349f.js"><link rel="prefetch" href="/readbook/assets/js/21.8853e1e1.js"><link rel="prefetch" href="/readbook/assets/js/22.90d3a464.js"><link rel="prefetch" href="/readbook/assets/js/23.fabe9af3.js"><link rel="prefetch" href="/readbook/assets/js/25.bc2baf43.js"><link rel="prefetch" href="/readbook/assets/js/26.ec5f48b3.js"><link rel="prefetch" href="/readbook/assets/js/27.284db135.js"><link rel="prefetch" href="/readbook/assets/js/28.8da8020e.js"><link rel="prefetch" href="/readbook/assets/js/29.642ed6af.js"><link rel="prefetch" href="/readbook/assets/js/3.516fd641.js"><link rel="prefetch" href="/readbook/assets/js/30.c42dcde0.js"><link rel="prefetch" href="/readbook/assets/js/31.5bf0ad56.js"><link rel="prefetch" href="/readbook/assets/js/32.28c4b9fc.js"><link rel="prefetch" href="/readbook/assets/js/33.8ba11b1c.js"><link rel="prefetch" href="/readbook/assets/js/34.f1f06cae.js"><link rel="prefetch" href="/readbook/assets/js/4.bb3de599.js"><link rel="prefetch" href="/readbook/assets/js/5.f324cf32.js"><link rel="prefetch" href="/readbook/assets/js/6.713fbf29.js"><link rel="prefetch" href="/readbook/assets/js/7.ea44b13f.js"><link rel="prefetch" href="/readbook/assets/js/8.19cb361c.js"><link rel="prefetch" href="/readbook/assets/js/9.12521701.js">
    <link rel="stylesheet" href="/readbook/assets/css/0.styles.d6f0e1c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/readbook/" class="home-link router-link-active"><!----> <span class="site-name">Ant Design 1111</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/readbook/intro.html" class="sidebar-link">前言</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>第一章: 基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/readbook/sc1lvc.html" class="sidebar-link">前端开发的演变</a></li><li><a href="/readbook/wybhm9.html" class="sidebar-link">初始化项目</a></li><li><a href="/readbook/fd5af7.html" class="sidebar-link">第一个组件</a></li><li><a href="/readbook/agmsgo.html" class="sidebar-link">使用 Ant Design 组件</a></li><li><a href="/readbook/goozth.html" class="sidebar-link">受控组件与非受控组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/readbook/chapter2.html" class="sidebar-heading clickable"><span>第二章: 布局与路由</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/readbook/layout.html" class="sidebar-link">基本布局</a></li><li><a href="/readbook/ghalng.html" class="sidebar-link">侧边导航</a></li><li><a href="/readbook/ipsba8.html" class="sidebar-link">路由配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/readbook/chapter3.html" class="sidebar-heading clickable"><span>第三章: 小试牛刀</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/readbook/abl3ad.html" class="sidebar-link">使用 model</a></li><li><a href="/readbook/dsl8ee.html" class="sidebar-link">搭建基于 model 的卡片列表页面</a></li><li><a href="/readbook/ig6mzb.html" class="sidebar-link">在 model 中请求服务端数据</a></li><li><a href="/readbook/kmmq56.html" class="sidebar-link">模拟服务端数据</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/readbook/chapter4.html" class="sidebar-heading clickable"><span>第四章: 复杂页面</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/readbook/ndfx96.html" class="sidebar-link">表格</a></li><li><a href="/readbook/up1dn3.html" class="sidebar-link">表单</a></li><li><a href="/readbook/dk8xsp.html" class="sidebar-link">图表</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>第五章: 进阶功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/readbook/customized_styles.html" class="sidebar-link">自定义样式</a></li><li><a href="/readbook/wvbsue.html" class="sidebar-link">上传与下载</a></li><li><a href="/readbook/aut0sr.html" class="active sidebar-link">国际化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/readbook/aut0sr.html#基本思路" class="sidebar-link">基本思路</a></li><li class="sidebar-sub-header"><a href="/readbook/aut0sr.html#antd-的国际化" class="sidebar-link">antd 的国际化</a></li><li class="sidebar-sub-header"><a href="/readbook/aut0sr.html#业务组件的国际化" class="sidebar-link">业务组件的国际化</a></li><li class="sidebar-sub-header"><a href="/readbook/aut0sr.html#在-umi-中使用" class="sidebar-link">在 umi 中使用</a></li><li class="sidebar-sub-header"><a href="/readbook/aut0sr.html#切换语言" class="sidebar-link">切换语言</a></li></ul></li><li><a href="/readbook/lifemethods.html" class="sidebar-link">React 的生命周期</a></li><li><a href="/readbook/auth.html" class="sidebar-link">权限</a></li><li><a href="/readbook/unittest.html" class="sidebar-link">单元测试</a></li><li><a href="/readbook/typescript.html" class="sidebar-link">使用 TypeScript</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>附录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/readbook/byllph.html" class="sidebar-link">你需要了解的 ES6 语法</a></li><li><a href="/readbook/tydf0a.html" class="sidebar-link">深入理解 umi</a></li><li><a href="/readbook/about.html" class="sidebar-link">关于我们</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h2 id="基本思路"><a href="#基本思路" aria-hidden="true" class="header-anchor">#</a> 基本思路</h2> <p>国际化是我们在项目中经常遇到的需求，在 React 的项目中实现国际化并不难。比如我们在初始化项目时写的 hello world 的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>要实现这个最简单页面的国际化那么其实只要能够将代码中的 <code>hello world</code> 替换为能够按照当前语言环境变化的变量即可：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> lang <span class="token operator">=</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>language<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> helloworld <span class="token operator">=</span> lang <span class="token operator">===</span> <span class="token string">'en-US'</span> <span class="token operator">?</span> <span class="token string">'hello world'</span> <span class="token punctuation">:</span> <span class="token string">'你好'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>helloworld<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>按照上面的代码，当 <code>lang</code> 不同时，<code>{helloworld}</code> 对应的实际的内容也会变得不一样。你可以在你的课程代码中尝试一下，你会得到中文的 <code>你好</code>。</p> <p>从这个例子其实可以看到，基于 React 开发的项目要实现国际化其实并不困难。只要你将你项目中原本写死的所有文案都替换成为能够按照语言环境而变化的变量即可。基于 antd 开发的项目国际化可以分为两部分，第一部分是 antd 组件的国际化，比如下图所示的 <code>DatePicker</code> 组件中的中文部分。第二部分是项目中自己开发的业务组件（页面）的国际化。</p> <p><img src="https://cdn.nlark.com/lark/0/2018/png/46271/1533020031930-644f2c58-cc42-4c0d-ae74-9f3ac8fd10c8.png" alt=""></p> <p>接下来会对这两部分分别做介绍。</p> <h2 id="antd-的国际化"><a href="#antd-的国际化" aria-hidden="true" class="header-anchor">#</a> antd 的国际化</h2> <p>在 <a href="https://ant.design/docs/react/i18n-cn" target="_blank" rel="noopener noreferrer">antd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中，提供了一个 <code>LocaleProvider</code> 组件。该组件接受一个属性 <code>locale</code>，该属性为当前语言的文案。antd 会通过 react 的 <a href="https://reactjs.org/docs/legacy-context.html" target="_blank" rel="noopener noreferrer">context<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 将这些信息传递给被 <code>LocaleProvider</code> 包裹的子组件，从而实现国际化。你可以参考下面的示例代码在你的课程代码中做一个实际的尝试：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对应课程参考代码中的 src/page/locale.js</span>
<span class="token keyword">import</span> zhCN <span class="token keyword">from</span> <span class="token string">'antd/lib/locale-provider/zh_CN'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> DatePicker<span class="token punctuation">,</span> LocaleProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>LocaleProvider locale<span class="token operator">=</span><span class="token punctuation">{</span>zhCN<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>DatePicker <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>LocaleProvider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如上所示，antd 提供了一些列的内置的语言资源，他们的位置在 <code>antd/lib/locale-provider/*</code>。我们直接使用它们作为 <code>LocaleProvider</code> 的 locale 属性。</p> <p><code>LocaleProvider</code> 组件中定义了 <a href="https://github.com/ant-design/ant-design/blob/master/components/locale-provider/index.tsx#L53" target="_blank" rel="noopener noreferrer">getChildContext<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它会将相关的国际化语言信息挂载到 context.antLocale 中，这样在它的子组件中被包含的 antd 组件就能够通过 context 获取到对应的国际化数据了。如果你对 antd 国际化的内部的细节感兴趣可以查看 antd 的源代码，在这里不做过多介绍。</p> <blockquote><p>注：antd 内部使用的 context 特性是原有的 React 版本的特性，在未来将会迁移到新的 <a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener noreferrer">API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，不过这对于 antd 的使用者来说是不需要关心的。</p></blockquote> <h2 id="业务组件的国际化"><a href="#业务组件的国际化" aria-hidden="true" class="header-anchor">#</a> 业务组件的国际化</h2> <p>除了组件的国际化以外，你可能还需要将你自己书写的业务组件进行国际化。我们推荐使用 <a href="https://npmjs.org/react-intl" target="_blank" rel="noopener noreferrer">react-intl<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来作为国际化方案。</p> <p>你首先需要使用下面的命令来安装 <code>react-intl</code>：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>cnpm <span class="token function">install</span> react-intl --save
</code></pre></div><p><code>react-intl</code> 的国际化方案和 <code>antd</code> 其实是类似的，它提供了一个 <code>IntlProvider</code> 组件，你可以把你的业务代码包装在这个组件中。然后就可以通过它提供的方法，在自己的业务组件里便利地实现国际化。我们继续基于上面创建的代码添加相关内容，如下面代码所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 对应课程参考代码中的 src/page/locale.js</span>
<span class="token keyword">import</span> zhCN <span class="token keyword">from</span> <span class="token string">'antd/lib/locale-provider/zh_CN'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> DatePicker<span class="token punctuation">,</span> LocaleProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  FormattedMessage<span class="token punctuation">,</span>
  IntlProvider<span class="token punctuation">,</span>
  addLocaleData<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-intl'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> zhData <span class="token keyword">from</span> <span class="token string">'react-intl/locale-data/zh'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'helloworld'</span><span class="token punctuation">:</span> <span class="token string">'你好'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">addLocaleData</span><span class="token punctuation">(</span>zhData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>IntlProvider locale<span class="token operator">=</span><span class="token string">&quot;zh&quot;</span> messages<span class="token operator">=</span><span class="token punctuation">{</span>messages<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>LocaleProvider locale<span class="token operator">=</span><span class="token punctuation">{</span>zhCN<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>DatePicker <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>FormattedMessage id<span class="token operator">=</span><span class="token string">&quot;helloworld&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>LocaleProvider<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>IntlProvider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过 <code>FormattedMessage</code> 组件，<code>react-intl</code> 会按照你传给这个组件的 id 找到当前对应语言的实际内容。当然在上面的例子中，页面最终会显示<code>你好</code>。你可以通过修改 <code>IntlProvider</code> 的属性 <code>messages</code> 的内容来切换页面中要显示的语言。</p> <p>除此之外还有一个 <code>locale</code> 属性，和 <code>addLocaleData</code> 方法。它们是用于指定 <code>react-intl</code> 中的一些非特殊场景的国际化资源的，比如 <code>react-intl</code> 提供的 <code>FormattedTime</code>。关于 <code>react-intl</code> 的更多 API 你可以参考它的<a href="https://github.com/yahoo/react-intl/wiki" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这里不做过多介绍。上面介绍的内容已经足以满足项目大部分场景的需求，但是你是不是觉得还是有一些复杂，或者说是麻烦。那么接下来我们会换一种更简洁的方式来做国际化，umi 提供了更方便的方案，当然umi 提供的方案也是基于上面所介绍的内容来支持的。</p> <h2 id="在-umi-中使用"><a href="#在-umi-中使用" aria-hidden="true" class="header-anchor">#</a> 在 umi 中使用</h2> <p>在 umi 中，为了方便开发者更方便的使用，对 <code>react-intl</code> 和 <code>antd</code> 进行了封装。你可以按照如下的方法更快的实现应用的国际化。</p> <h3 id="初始化配置"><a href="#初始化配置" aria-hidden="true" class="header-anchor">#</a> 初始化配置</h3> <p>在 umi 中，你可以通过在插件集 umi-plugin-react 中配置 locale 打开 umi-plugin-locale 插件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'umi-plugin-react'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      antd<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      dva<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      locale<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        enable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>之后 umi 会帮你在自动的通过 <code>LocaleProvider</code> 将 antd 的组件国际化。它会按照当前浏览器的语言自动切换语言，当然你也可以通过配置关闭自动选择语言的功能，通过它提供的 API 设置语言。另外，它约定了 <code>locale</code> 目录作为业务相关资源的存放路径。你可以简单的就能实现业务组件的国际化。</p> <p>具体 <code>locale</code> 的配置详情和 API 参考相关<a href="https://github.com/umijs/umi-plugin-locale#usage" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="业务组件国际化"><a href="#业务组件国际化" aria-hidden="true" class="header-anchor">#</a> 业务组件国际化</h3> <p>以 hello world 为例子，添加上一步的配置后，我们在 <code>src</code> 目录下新建 <code>locale</code> 文件夹，并新建 <code>zh-CN.js</code> 和 <code>en-US</code> 两个文件。内容分别如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/locale/zh-CN.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  helloworld<span class="token punctuation">:</span> <span class="token string">'你好'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/locale/en-US.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  helloworld<span class="token punctuation">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后修改 <code>HelloWorld.js</code> 为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  FormattedMessage<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi/locale'</span><span class="token punctuation">;</span>
<span class="token comment">// src/page/HelloWorld.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>FormattedMessage id<span class="token operator">=</span><span class="token string">&quot;helloworld&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>某些情况下你可能需要在 JS 逻辑中拿到相关文案而不是在 JSX 中通过 <code>FormattedMessage</code> 组件使用，那么你可以使用 <code>formatMessage</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  formatMessage<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'umi/locale'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">formatMessage</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'helloworld'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="切换语言"><a href="#切换语言" aria-hidden="true" class="header-anchor">#</a> 切换语言</h2> <p>我们通过 <code>IntlProvider</code> 和 <code>LocaleProvider</code> 的属性（locale 和 messages）可以指定当前应用的语言，同样的通过修改我们传递给它们的属性来实现语言的切换。同时为了更好的用户体验，我们应该保存用户当前选择的语言，以至于用户刷新页面之后不会丢失之前的选择。你可以通过 localStorage 来实现。当用户点击语言切换的按钮（或者下拉菜单）后，我们将用户选择的语言保存到 localStorage 中，同时切换语言。</p> <p>在教程对应的代码的 <code>layouts/GlobalHeader.js</code> 文件中我们添加了一段代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>Button
  size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span>
  onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changLang</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>FormattedMessage id<span class="token operator">=</span><span class="token string">&quot;lang&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
</code></pre></div><p>通过这段代码我们在应用的顶部导航栏添加了一个按钮，点击这个按钮则会调用 <code>changLang</code> 切换语言，<code>changLang</code> 的代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">changLang</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> locale <span class="token operator">=</span> <span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locale <span class="token operator">||</span> locale <span class="token operator">===</span> <span class="token string">'zh-CN'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLocale</span><span class="token punctuation">(</span><span class="token string">'en-US'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">setLocale</span><span class="token punctuation">(</span><span class="token string">'zh-CN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>getLocale</code> 和 <code>setLocale</code> 是 <code>umi/locale</code> 中提供的方法。如果你没有用 <code>umi</code> 你也可以自己通过 <code>localStorage</code> 来实现。在 <code>setLocale</code> 中我们把语言信息保存到了 localStorage 中，然后刷新页面。刷新页面后应用会重新初始化，页面会重新渲染。然后我们就可以在应用启动时通过 <code>getLocale</code> 拿到用户选择的语言并设置到 <code>IntlProvider</code> 和 <code>LocaleProvider</code> 上面。当然，如果你使用了 <code>umi</code>，你只需要调用 <code>setLocale</code> 即可，其它的操作它会帮你完成。</p> <blockquote><p>当然，如果要追求更好的用户体验 <code>setLocale</code> 后不应该刷新页面就可以做到语言的实时切换，这部分内容我们会在后面补充完善。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/readbook/wvbsue.html" class="prev">
          上传与下载
        </a></span> <span class="next"><a href="/readbook/lifemethods.html">
          React 的生命周期
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/readbook/assets/js/app.205826b5.js" defer></script><script src="/readbook/assets/js/2.6adc2b3f.js" defer></script><script src="/readbook/assets/js/24.af897bcf.js" defer></script>
  </body>
</html>
