(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{241:function(n,t,e){"use strict";e.r(t);var a=e(28),o=Object(a.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"图片水印"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#图片水印"}},[n._v("#")]),n._v(" 图片水印")]),n._v(" "),e("div",{staticClass:"lake-content-editor-core lake-engine lake-typography-traditional",attrs:{"data-lake-element":"root"}},[e("h4",{attrs:{id:"水印模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#水印模块"}},[n._v("#")]),n._v(" 水印模块")]),n._v(" "),e("div",{attrs:{"data-card-type":"block","data-lake-card":"codeblock",id:"sXwlw"}},[e("div",{staticClass:"lake-codeblock-content",staticStyle:{border:"1px solid rgb(232, 232, 232)","max-width":"750px",color:"rgb(89, 89, 89)",margin:"0px",padding:"0px",background:"rgb(249, 249, 249)"}},[e("div",{staticStyle:{color:"rgb(89, 89, 89)",margin:"0px",padding:"16px",background:"none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0)"}},[e("div",{staticClass:"language-undefined extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("import { createGlobalStyle } from 'styled-components'\n\n// 卡片水印\n// 防止表格遮挡水印\nconst Water = createGlobalStyle`\n .ant-card {\n   // prettier-ignore\n   background-position: 0 0, 160PX 160PX !important;\n   background-repeat: repeat, repeat !important;\n   background-image: url('${window.location.origin}/script/account/print.svg'), url('${window.location.origin}/script/account/print.svg') !important;\n }\n .ant-table-placeholder {\n   background: transparent !important;\n }\n`\n\nexport default Water\n\n")])])])])])]),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[e("br")]),n._v(" "),e("h4",{attrs:{id:"获取水印"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取水印"}},[n._v("#")]),n._v(" 获取水印")]),n._v(" "),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[n._v("app/router.js")]),e("div",{attrs:{"data-card-type":"block","data-lake-card":"codeblock",id:"FAlfY"}},[e("div",{staticClass:"lake-codeblock-content",staticStyle:{border:"1px solid rgb(232, 232, 232)","max-width":"750px",color:"rgb(89, 89, 89)",margin:"0px",padding:"0px",background:"rgb(249, 249, 249)"}},[e("div",{staticStyle:{color:"rgb(89, 89, 89)",margin:"0px",padding:"16px",background:"none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0)"}},[e("div",{staticClass:"language-undefined extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("router.get('/script/account/print.svg', controller.script.account.print) \n")])])])])])]),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[e("br")]),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[n._v("app/controller/script/account.js")]),e("div",{attrs:{"data-card-type":"block","data-lake-card":"codeblock",id:"dDbko"}},[e("div",{staticClass:"lake-codeblock-content",staticStyle:{border:"1px solid rgb(232, 232, 232)","max-width":"750px",color:"rgb(89, 89, 89)",margin:"0px",padding:"0px",background:"rgb(249, 249, 249)"}},[e("div",{staticStyle:{color:"rgb(89, 89, 89)",margin:"0px",padding:"16px",background:"none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0)"}},[e("div",{staticClass:"language-undefined extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("'use strict'\n\nconst { Controller } = require('egg')\nconst path = require('path')\nconst TextToSVG = require('text-to-svg')\n\nconst textToSVG = TextToSVG.loadSync(path.resolve(__dirname, '../../fonts/SourceHanSansCN-Light.otf'))\nconst attributes = { fill: '#ededed', stroke: '#ededed', transform: 'rotate(-20, 90 75)' }\nconst options = { anchor: 'center middle', x: 160, y: 160, width: 320, height: 320, fontSize: 18, letterSpacing: 0.05, attributes }\n\nconst getSvgContent = text => {\n const svgPath = textToSVG.getPath(text, options)\n\n return `<svg xmlns=\"http://www.w3.org/2000/svg\" xlink=\"http://www.w3.org/1999/xlink\" width=\"${options.width}\" height=\"${options.height}\">${svgPath}</svg>`\n}\n\nconst loginRules = {\n token: {\n   type: 'string',\n   required: true,\n },\n}\n\nclass EggController extends Controller {\n async print() {\n   const accountInfo = await this.ctx.adminUser.getAccountInfo()\n   const { isLogin, name, mobile } = accountInfo\n   const content = isLogin ? `${name}${String(mobile).slice(7)}` : '小帮规划'\n\n   this.ctx.type = 'image/svg+xml'\n   this.ctx.body = getSvgContent(content)\n }\n\n async infojs() {\n   const token = await this.ctx.cookieUtils.getToken()\n   const accountInfo = await this.ctx.adminUser.getAccountInfo()\n   const info = Object.assign({ token }, accountInfo)\n\n   this.ctx.type = 'application/javascript'\n   this.ctx.body = `\n     window.APP_ACCOUNT = ${JSON.stringify(info)};\n   `\n }\n\n async login() {\n   try {\n     this.ctx.validator.validateBody(loginRules)\n   } catch (error) {\n     return this.ctx.reject(10004, error.message)\n   }\n\n   const { token } = this.ctx.request.body\n   this.ctx.cookieUtils.setToken(token)\n\n   return this.ctx.resolve()\n }\n\n async logout() {\n   const { deprecateTokenKey } = this.app.config\n\n   this.ctx.cookieUtils.removeToken()\n   this.ctx.cookies.set(deprecateTokenKey, null, this.ctx.cookieUtils.cookieOptions)\n\n   return this.ctx.redirect('/')\n }\n}\n\nmodule.exports = EggController\n\n")])])])])])]),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[e("br")]),n._v(" "),e("h4",{attrs:{id:"依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[n._v("#")]),n._v(" 依赖")]),n._v(" "),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[n._v("package.json")]),e("div",{attrs:{"data-card-type":"block","data-lake-card":"codeblock",id:"izwmY"}},[e("div",{staticClass:"lake-codeblock-content",staticStyle:{border:"1px solid rgb(232, 232, 232)","max-width":"750px",color:"rgb(89, 89, 89)",margin:"0px",padding:"0px",background:"rgb(249, 249, 249)"}},[e("div",{staticStyle:{color:"rgb(89, 89, 89)",margin:"0px",padding:"16px",background:"none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0)"}},[e("div",{staticClass:"language-undefined extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('"@types/styled-components": "^5.0.1",\n"babel-plugin-styled-components": "^1.10.7",\n"styled-components": "^5.0.1", \n')])])])])])]),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[e("br")]),n._v(" "),e("h4",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[n._v("#")]),n._v(" 配置")]),n._v(" "),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[n._v(".umirc.js")]),e("div",{attrs:{"data-card-type":"block","data-lake-card":"codeblock",id:"MXGG0"}},[e("div",{staticClass:"lake-codeblock-content",staticStyle:{border:"1px solid rgb(232, 232, 232)","max-width":"750px",color:"rgb(89, 89, 89)",margin:"0px",padding:"0px",background:"rgb(249, 249, 249)"}},[e("div",{staticStyle:{color:"rgb(89, 89, 89)",margin:"0px",padding:"16px",background:"none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0)"}},[e("div",{staticClass:"language-undefined extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("extraBabelPlugins: [\n   [\n     'babel-plugin-styled-components',\n     {\n       ssr: false,\n       fileName: false,\n       displayName: false,\n     },\n   ],\n ],\n\n")])])])])])]),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[e("br")]),n._v(" "),e("h4",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[n._v("#")]),n._v(" 使用")]),n._v(" "),e("div",{attrs:{"data-card-type":"block","data-lake-card":"codeblock",id:"tFc08"}},[e("div",{staticClass:"lake-codeblock-content",staticStyle:{border:"1px solid rgb(232, 232, 232)","max-width":"750px",color:"rgb(89, 89, 89)",margin:"0px",padding:"0px",background:"rgb(249, 249, 249)"}},[e("div",{staticStyle:{color:"rgb(89, 89, 89)",margin:"0px",padding:"16px",background:"none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0)"}},[e("div",{staticClass:"language-undefined extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("import { useState, useEffect, Fragment } from 'react'\nimport { ConfigProvider } from 'antd'\nimport ProLayout from '@ant-design/pro-layout'\nimport Dashboard from '@xb/layouts/Dashboard'\nimport Water from '@xb/components/Water'\nimport PageLoading from '@xb/components/PageLoading'\nimport HeaderContent from '@xb/components/HeaderContent'\nimport router from 'umi/router'\nimport { registerApplication, start } from 'single-spa'\nimport { connect } from 'dva'\nimport iconLogo from '@xb/assets/logo.gif'\n\n// 布局默认样式配置\nconst layoutSettings = {\n navTheme: 'dark',\n primaryColor: '#1890ff',\n layout: 'sidemenu',\n contentWidth: 'Fluid',\n fixedHeader: true,\n autoHideHeader: false,\n fixSiderbar: true,\n menu: {\n   locale: true,\n },\n title: '小帮规划',\n pwa: false,\n colorWeak: false,\n}\n\nconst { mobileLayoutPrefix, wxworkAuthBlackList, menuList, subappList } = window.APP_STATE\n\n// 获取扁平菜单标识\nconst getFlattenKeys = menuList => {\n let flattenKeys = []\n\n menuList.forEach(item => {\n   flattenKeys.push({\n     path: item.path,\n     keys: item.keys,\n   })\n\n   if (item.children) {\n     flattenKeys = [...flattenKeys, ...getFlattenKeys(item.children)]\n   }\n })\n\n return flattenKeys\n}\n\n// 判断当前菜单是否展开\nconst isMenuExpanded = (currentKeys = [], menuKeys = []) => {\n const currentKey = currentKeys.join(',')\n const menuKey = menuKeys.join(',')\n\n return currentKey.indexOf(menuKey) !== -1\n}\n\n// 获取父级菜单展开键\nconst getFatherKeys = (keys = []) => {\n return keys.filter((item, index) => index + 1 !== keys.length)\n}\n\n// 获取默认展开菜单\nconst flattenKeys = getFlattenKeys(menuList)\nconst defaultMenu = flattenKeys.find(item => item.path === window.location.pathname)\nconst defaultOpenKeys = defaultMenu ? defaultMenu.keys : []\n\nconst BasicLayout = ({ collapsed, location, dispatch }) => {\n const [openKeys, setOpenKeys] = useState(defaultOpenKeys)\n\n const { pathname } = location\n\n // 获取应用名称\n const getAppByPath = pathname => {\n   const row = subappList.find(({ manifest }) => {\n     return manifest.paths.some(prefix => pathname.startsWith(prefix))\n   })\n\n   return Object.assign({}, row)\n }\n\n // 应用注册\n useEffect(() => {\n   subappList.forEach(({ name, manifest }) => {\n     const loadingFunction = () => window.System.import(manifest.mainScript)\n\n     const activityFunction = location => {\n       const isMatched = manifest.paths.some(prefix => location.pathname.startsWith(prefix))\n       return isMatched\n     }\n\n     registerApplication(name, loadingFunction, activityFunction)\n     start()\n   })\n }, [])\n\n // 侧边栏开关\n const onCollapse = collapsed => {\n   dispatch({\n     type: 'global/changeLayoutCollapsed',\n     payload: Boolean(collapsed),\n   })\n }\n\n // 获取当前子应用\n const { name: sourceAppName, manifest: sourceManifest } = getAppByPath(pathname)\n const hasMatched = Boolean(sourceAppName && sourceManifest)\n\n // 菜单数据\n const menuDataRender = () => menuList\n\n // 父级菜单\n const subMenuItemRender = (menuItemProps, defaultDom) => {\n   const onMenuItemClick = () => {\n     const isExpanded = isMenuExpanded(openKeys, menuItemProps.keys)\n     const keys = isExpanded ? getFatherKeys(menuItemProps.keys) : menuItemProps.keys\n     setOpenKeys(keys)\n   }\n\n   return (\n     <div style=\"{{\" overflow: 'hidden' }} onclick=\"{onMenuItemClick}\">\n       {defaultDom}\n     </div>\n   )\n }\n\n // 基础菜单\n // 参考文档 http://docs.xiaobangtouzi.com/pages/viewpage.action?pageId=6529045\n const menuItemRender = (menuItemProps, defaultDom) => {\n   const onItemClick = () => {\n     setOpenKeys(menuItemProps.keys)\n\n     const { name: targetAppName } = getAppByPath(menuItemProps.path)\n     const httpReload = sourceAppName !== targetAppName\n     const isReplacePath = pathname === menuItemProps.path\n\n     switch (menuItemProps.type) {\n       case 0:\n         return window.open(window.APP_HERO.Linker.getDeprecatedAdminUrl(menuItemProps.path))\n       case 1:\n         return window.open(window.APP_HERO.Linker.getInsuranceAdminUrl(menuItemProps.path))\n       case 2:\n         if (httpReload) {\n           return isReplacePath ? window.location.replace(menuItemProps.path) : window.open(menuItemProps.path, '_self')\n         }\n\n         return isReplacePath ? router.replace({ pathname: menuItemProps.path }) : router.push({ pathname: menuItemProps.path })\n       case 3:\n         return window.open(menuItemProps.originalUrl)\n       default:\n         return null\n     }\n   }\n\n   return (\n     <div style=\"{{\" overflow: 'hidden' }} onclick=\"{onItemClick}\">\n       {defaultDom}\n     </div>\n   )\n }\n\n const children = (\n   <fragment>\n     <water>\n     <div id=\"sub-app\">\n       {/* 首页友情提示 */}\n       {pathname === '/' && <dashboard>}\n       {/* 子应用匹配成功显示默认加载动画 */}\n       {hasMatched && <pageloading>}\n     </pageloading></dashboard></div>\n     {/* 异步加载样式 */}\n     {hasMatched && <link rel=\"stylesheet\" href=\"{sourceManifest.mainStyle}\">}\n   </water></fragment>\n )\n\n // 没有侧边栏\n const withoutLayout = wxworkAuthBlackList.includes(pathname) || pathname.startsWith(mobileLayoutPrefix)\n\n if (withoutLayout) {\n   return <configprovider autoinsertspaceinbutton=\"{false}\">{children}</configprovider>\n }\n\n return (\n   <configprovider autoinsertspaceinbutton=\"{false}\">\n     <prolayout menuprops=\"{{\" openkeys }} logo=\"{iconLogo}\" settings=\"{layoutSettings}\" collapsed=\"{collapsed}\" oncollapse=\"{onCollapse}\" submenuitemrender=\"{subMenuItemRender}\" menuitemrender=\"{menuItemRender}\" menudatarender=\"{menuDataRender}\" footerrender=\"{false}\" rightcontentrender=\"{props\" => <headercontent {...props}>}\n       {...layoutSettings}\n     >\n       {children}\n     </headercontent></prolayout>\n   </configprovider>\n )\n}\n\nconst connector = ({ global: { collapsed } }) => ({ collapsed })\nexport default connect(connector)(BasicLayout)\n\n")])])])])])]),e("p",{staticStyle:{"font-size":"14px",color:"rgb(38, 38, 38)","line-height":"1.74","letter-spacing":"0.05em","outline-style":"none","overflow-wrap":"break-word",margin:"0px"}},[e("br")])])])}),[],!1,null,null,null);t.default=o.exports}}]);